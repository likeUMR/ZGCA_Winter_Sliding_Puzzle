# 排行榜系统 API 使用指南

本服务提供统一的游戏排行榜功能，支持多款游戏的排行榜功能，包括普通分数记录和通关时间记录（First-Clear 榜）。

**API 服务地址**: `leaderboard.liruochen.cn`

---

## 1. 上传分数 / 录入通关信息

通过调用 `/api/upload` 接口来录入玩家的通关记录或分数。

### 接口信息
- **URL**: `POST https://leaderboard.liruochen.cn/api/upload`
- **Content-Type**: `application/json`

### 参数说明
- `game_id` (string, 必填): 游戏唯一标识（如 `majiang`, `cyber-cat` 等，需在 `config.py` 白名单中）
- `user_id` (string, 必填): 玩家唯一标识。可以是任何形式（如 "张三123"），确保唯一即可
- `score` (int, 必填): 分数
    - 对于**普通榜单**，系统保留最高分
    - 对于**通关时间榜**（字段名在 `config.py` 的 `TIME_SENSITIVE_FIELDS` 中，如 `clear_time`），分数会被自动设为 `1`，且系统**只记录该玩家第一次上传的时间**
- `field_id` (string, 可选): 榜单类型/维度。默认为 `main`。若记录通关，请确保配置了对应的通关字段（如 `clear_time`）

### 请求示例 (JSON)
```json
{
    "game_id": "majiang",
    "user_id": "player_001",
    "score": 1500,
    "field_id": "main"
}
```

### 请求示例 (curl)
```bash
curl -X POST https://leaderboard.liruochen.cn/api/upload \
     -H "Content-Type: application/json" \
     -d '{
           "game_id": "majiang",
           "user_id": "玩家A_001",
           "score": 1,
           "field_id": "clear_time"
         }'
```

---

## 2. 查询特定玩家分数与名次

通过调用 `/api/player_score` 接口查询特定玩家在某个榜单中的表现。

### 接口信息
- **URL**: `POST https://leaderboard.liruochen.cn/api/player_score`
- **Content-Type**: `application/json`

### 参数说明
- `game_id` (string, 必填): 游戏标识
- `user_id` (string, 必填): 玩家唯一标识
- `field_id` (string, 可选): 榜单类型/维度（如 `main` 或 `clear_time`），默认为 `main`

### 请求示例 (JSON)
```json
{
    "game_id": "majiang",
    "user_id": "player_001",
    "field_id": "main"
}
```

### 请求示例 (curl)
```bash
curl -X POST https://leaderboard.liruochen.cn/api/player_score \
     -H "Content-Type: application/json" \
     -d '{
           "game_id": "majiang",
           "user_id": "玩家A_001",
           "field_id": "clear_time"
         }'
```

### 返回结果示例
```json
{
    "game_id": "majiang",
    "field_id": "clear_time",
    "user_id": "玩家A_001",
    "score": 1,
    "rank": 5,
    "created_at": "2026-01-21 12:34:56"
}
```
*注：`rank` 字段即为玩家当前的实时名次。*

---

## 3. 查询前 K 名玩家 (Top K)

通过调用 `/api/top_players` 接口获取榜单前几名的完整列表。

### 接口信息
- **URL**: `POST https://leaderboard.liruochen.cn/api/top_players`
- **Content-Type**: `application/json`

### 参数说明
- `game_id` (string, 必填): 游戏标识
- `top` (int, 可选): 需要返回的数量 (K)，默认为 10
- `field_id` (string, 可选): 榜单类型/维度，默认为 `main`

### 请求示例 (JSON)
```json
{
    "game_id": "majiang",
    "top": 5,
    "field_id": "time"
}
```

### 请求示例 (curl)
```bash
curl -X POST https://leaderboard.liruochen.cn/api/top_players \
     -H "Content-Type: application/json" \
     -d '{
           "game_id": "majiang",
           "top": 30,
           "field_id": "clear_time"
         }'
```

---

## 重要说明

### 关于用户 ID
`user_id` 是一个字符串字段。为了防止重名并保留人名信息，建议使用 `人名+数字/UUID` 的格式，例如 `liruochen_8892`。只要字符串全局唯一，系统即可正确区分用户。

### 最高分保留机制
同一玩家在同一游戏的同一维度下多次上传，系统仅保留**最高分**。

### 白名单机制
仅支持 `config.py` 中预设的游戏 ID 和维度 ID，否则会返回 400 错误。如需添加新游戏或新维度，请联系管理员。

### 网页端查看
- **汇总页**: `https://leaderboard.liruochen.cn/`
- **游戏详情页**: `https://leaderboard.liruochen.cn/{game_id}?field_id={field_id}`

---

